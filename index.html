<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Простой трекер смен</title>
  <style>
    :root{ --bg:#f6f7f9; --card:#fff; --accent:#0a84ff; --danger:#d64545; --text:#111; }
    *{box-sizing:border-box}
    body{font-family:system-ui,Arial; margin:0; background:var(--bg); color:var(--text); padding:14px}
    .wrap{max-width:720px;margin:0 auto}
    h1{font-size:18px;margin:0 0 10px}
    .card{background:var(--card);padding:10px;border-radius:8px;margin-bottom:10px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    label{font-size:13px}
    input[type="date"],input[type="time"],input[type="number"],input[type="text"]{padding:6px;border:1px solid #ddd;border-radius:6px}
    button{background:var(--accent);color:#fff;border:0;padding:7px 10px;border-radius:6px;cursor:pointer}
    button.danger{background:var(--danger)}
    table{width:100%;border-collapse:collapse;margin-top:8px;font-size:13px}
    th,td{padding:6px 4px;text-align:left;border-bottom:1px solid #eee}
    td.actions{white-space:nowrap}
    .muted{color:#666;font-size:13px}
    @media (max-width:520px){ .row{flex-direction:column;align-items:stretch} }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Простой трекер смен</h1>

    <div class="card" id="settings">
      <div class="row">
        <label>Ставка/час:
          <input id="rate" type="number" min="0" step="0.01" style="width:110px" />
        </label>
        <label>Валюта:
          <input id="currency" type="text" maxlength="4" style="width:70px" />
        </label>
        <button id="clearAll" class="danger" title="Удалить все записи">Очистить</button>
      </div>
      <div class="muted" style="margin-top:8px">Made in Russia by Aleksei | 2025</div>
    </div>

    <div class="card" id="formCard">
      <form id="shiftForm" class="row" onsubmit="return false">
        <input id="shiftId" type="hidden" />
        <label>Дата: <input id="date" type="date" required /></label>
        <label>Начало: <input id="start" type="time" required /></label>
        <label>Конец: <input id="end" type="time" required /></label>
        <label>Оплата: <input id="paid" type="checkbox" /></label>
        <div style="display:flex;gap:6px;align-items:center">
          <button id="save">Добавить</button>
          <button id="cancel" style="background:#888">Отмена</button>
        </div>
      </form>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Список смен</strong>
        <div class="muted" id="counts"></div>
      </div>
      <table id="table">
        <thead>
          <tr>
            <th>Дата</th>
            <th>Время</th>
            <th>Часы</th>
            <th>Сумма</th>
            <th>Опл.</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="muted" id="summary" style="margin-top:8px"></div>
    </div>
  </div>

  <script>
    (function(){
      const KEY = 'simple_shifts_v1';
      let shifts = [];

      const rateEl = document.getElementById('rate');
      const currencyEl = document.getElementById('currency');
      const clearAllBtn = document.getElementById('clearAll');
      const saveBtn = document.getElementById('save');
      const cancelBtn = document.getElementById('cancel');
      const idEl = document.getElementById('shiftId');
      const dateEl = document.getElementById('date');
      const startEl = document.getElementById('start');
      const endEl = document.getElementById('end');
      const paidEl = document.getElementById('paid');
      const tbody = document.querySelector('#table tbody');
      const summaryEl = document.getElementById('summary');
      const countsEl = document.getElementById('counts');

      function load(){
        try {
          const raw = localStorage.getItem(KEY);
          if(raw) shifts = JSON.parse(raw);
        } catch(e){ shifts = []; }
        if(!rateEl.value) rateEl.value = 200;
        if(!currencyEl.value) currencyEl.value = '₽';
        render();
      }

      function saveStorage(){
        try { localStorage.setItem(KEY, JSON.stringify(shifts)); } catch(e){}
      }

      function resetForm(){
        idEl.value = '';
        dateEl.value = '';
        startEl.value = '';
        endEl.value = '';
        paidEl.checked = false;
        saveBtn.textContent = 'Добавить';
      }

      function computeHours(start, end){
        const [sh, sm] = start.split(':').map(Number);
        const [eh, em] = end.split(':').map(Number);
        let s = sh*60 + sm;
        let e = eh*60 + em;
        if(e <= s) e += 24*60;
        return Math.round(((e - s)/60) * 100) / 100;
      }

      function render(){
        tbody.innerHTML = '';
        const items = shifts.slice().sort((a,b)=> a.date.localeCompare(b.date) || a.start.localeCompare(b.start));
        let totalH = 0, totalE = 0, totalP = 0;
        const rate = Number(rateEl.value) || 0;

        items.forEach(s => {
          const h = computeHours(s.start, s.end);
          const e = Math.round(h * rate * 100) / 100;
          totalH += h; totalE += e; if(s.paid) totalP += e;

          const tr = document.createElement('tr');
          tr.innerHTML = 
            <td>${s.date}</td>
            <td>${s.start}-${s.end}</td>
            <td>${h}</td>
            <td>${e} ${currencyEl.value}</td>
            <td>${s.paid ? '✅' : ''}</td>
            <td class="actions">
              <button class="edit" data-id="${s.id}">Изм</button>
              <button class="del" data-id="${s.id}" style="background:var(--danger)">Уд</button>
            </td>
          ;
          tbody.appendChild(tr);
        });
        summaryEl.textContent = Итого: ${totalE} ${currencyEl.value} (Осталось получить: ${Math.round((totalE-totalP)*100)/100});
        countsEl.textContent = ${items.length} шт.;
      }

      saveBtn.addEventListener('click', ()=>{
        if(!dateEl.value ⠞⠟⠞⠞⠵⠟⠞⠵⠵⠞⠵⠺⠺⠺⠺⠵ !endEl.value) return;
        const data = { id: idEl.value || Date.now().toString(36), date: dateEl.value, start: startEl.value, end: endEl.value, paid: paidEl.checked };
        if(idEl.value){
          const idx = shifts.findIndex(x=>x.id === idEl.value);
          if(idx > -1) shifts[idx] = data;
        } else {
          shifts.push(data);
        }
        saveStorage(); resetForm(); render();
      });

      tbody.addEventListener('click', (e)=>{
        const id = e.target.dataset.id;
        if(!id) return;
        if(e.target.classList.contains('del')){
          if(confirm('Удалить?')) { shifts = shifts.filter(x=>x.id !== id); saveStorage(); render(); }
        } else if(e.target.classList.contains('edit')){
          const s = shifts.find(x=>x.id === id);
          idEl.value = s.id; dateEl.value = s.date; startEl.value = s.start; endEl.value = s.end; paidEl.checked = s.paid;
          saveBtn.textContent = 'Обновить';
        }
      });

      clearAllBtn.addEventListener('click', ()=>{
        if(confirm('Удалить всё?')) { shifts = []; saveStorage(); render(); }
      });

      cancelBtn.addEventListener('click', resetForm);
      load();
    })();
  </script>
</body>
</html>
