<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Трекер смен</title>
  <style>
    :root{ --bg:#f6f7f9; --card:#fff; --accent:#0a84ff; --danger:#d64545; --text:#111; }
    *{box-sizing:border-box}
    body{font-family:system-ui,Arial; margin:0; background:var(--bg); color:var(--text); padding:14px}
    .wrap{max-width:720px;margin:0 auto}
    h1{font-size:18px;margin:0 0 10px}
    .card{background:var(--card);padding:10px;border-radius:8px;margin-bottom:10px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    label{font-size:13px}
    input[type="date"],input[type="time"],input[type="number"],input{padding:6px;border:1px solid #ddd;border-radius:6px}
    button{background:var(--accent);color:#fff;border:0;padding:7px 10px;border-radius:6px;cursor:pointer}
    button.danger{background:var(--danger)}
    table{width:100%;border-collapse:collapse;margin-top:8px;font-size:13px}
    th,td{padding:6px 4px;text-align:left;border-bottom:1px solid #eee}
    .muted{color:#666;font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Простой трекер смен</h1>
    <div class="card">
      <div class="row">
        <label>Ставка/час: <input id="rate" type="number" value="200" style="width:80px" /></label>
        <label>Валюта: <input id="currency" type="text" value="₽" style="width:50px" /></label>
        <button id="clearAll" class="danger">Очистить всё</button>
      </div>
    </div>

    <div class="card">
      <form id="shiftForm" class="row" onsubmit="return false">
        <input id="shiftId" type="hidden" />
        <label>Дата: <input id="date" type="date" required /></label>
        <label>Начало: <input id="start" type="time" required /></label>
        <label>Конец: <input id="end" type="time" required /></label>
        <label>Оплата: <input id="paid" type="checkbox" /></label>
        <button id="save">Добавить</button>
        <button id="cancel" type="button" style="background:#888">Отмена</button>
      </form>
    </div>

    <div class="card">
      <table id="table">
        <thead>
          <tr><th>Дата</th><th>Время</th><th>Часы</th><th>Сумма</th><th>Опл.</th><th>Действия</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="summary" class="muted" style="margin-top:10px"></div>
    </div>
  </div>

  <script>
    (function(){
      const KEY = 'shifts_data_2025';
      let shifts = JSON.parse(localStorage.getItem(KEY) || '[]');

      const els = {
        rate: document.getElementById('rate'),
        curr: document.getElementById('currency'),
        tbody: document.querySelector('#table tbody'),
        summary: document.getElementById('summary'),
        form: document.getElementById('shiftForm'),
        save: document.getElementById('save'),
        id: document.getElementById('shiftId'),
        date: document.getElementById('date'),
        start: document.getElementById('start'),
        end: document.getElementById('end'),
        paid: document.getElementById('paid')
      };

      function computeHours(s, e) {
        let [sh, sm] = s.split(':').map(Number);
        let [eh, em] = e.split(':').map(Number);
        let startMins = sh * 60 + sm;
        let endMins = eh * 60 + em;
        if (endMins <= startMins) endMins += 1440;
        return Math.round(((endMins - startMins) / 60) * 100) / 100;
      }

      function render() {
        els.tbody.innerHTML = '';
        let totalH = 0, totalE = 0, totalP = 0;
        shifts.sort((a,b) => a.date.localeCompare(b.date)).forEach(s => {
          const h = computeHours(s.start, s.end);
          const e = Math.round(h * Number(els.rate.value) * 100) / 100;
          totalH += h; totalE += e; if(s.paid) totalP += e;
          const tr = document.createElement('tr');
          tr.innerHTML = <td>${s.date}</td><td>${s.start}-${s.end}</td><td>${h}</td><td>${e} ${els.curr.value}</td><td>${s.paid?'✅':''}</td>
            <td><button onclick="editShift('${s.id}')">✎</button> <button class="danger" onclick="delShift('${s.id}')">✕</button></td>;
          els.tbody.appendChild(tr);
        });
        els.summary.textContent = Всего: ${totalE} ${els.curr.value} | Оплачено: ${totalP} | Долг: ${(totalE-totalP).toFixed(2)};
        localStorage.setItem(KEY, JSON.stringify(shifts));
      }

      els.save.onclick = () => {
        if(!els.date.value ⠺⠞⠵⠞⠟⠵⠞⠟⠟⠟⠺⠟⠟⠺⠟⠵⠺⠺ !els.end.value) return alert('Заполните поля');
        const data = { id: els.id.value || Date.now().toString(), date: els.date.value, start: els.start.value, end: els.end.value, paid: els.paid.checked };
        if(els.id.value) {
          const idx = shifts.findIndex(x => x.id === els.id.value);
          shifts[idx] = data;
        } else {
          shifts.push(data);
        }
        els.form.reset(); els.id.value = ''; els.save.textContent = 'Добавить'; render();
      };

      window.editShift = (id) => {
        const s = shifts.find(x => x.id === id);
        els.id.value = s.id; els.date.value = s.date; els.start.value = s.start; els.end.value = s.end; els.paid.checked = s.paid;
        els.save.textContent = 'Обновить';
      };

      window.delShift = (id) => { if(confirm('Удалить?')) { shifts = shifts.filter(x => x.id !== id); render(); } };
      document.getElementById('clearAll').onclick = () => { if(confirm('Очистить всё?')) { shifts = []; render(); } };
      document.getElementById('cancel').onclick = () => { els.form.reset(); els.id.value = ''; els.save.textContent = 'Добавить'; };
      
      els.rate.oninput = render;
      els.curr.oninput = render;
      render();
    })();
  </script>
</body>
</html>
